---
title: 3D Geometry(2):3D Transformation & Epipolar Geometry
author: onebom
date: 2023-09-08 18:15:00 +0800
categories: [Graphics,3D Geometry]
tags: [3D]
toc: true
math: true
---

## 1.3D Transformation
3D변환은 2차원 affine 변환과 크게 다르지 않은 3차원 행렬표현이다.

### 1-1) Transformation Matrix
3D 변환에 쓰이는 matrix는 다음과 같다;

x,y,z 축을 중심으로 라디안 회전시키는 행렬, R_x(θ), R_y(θ), R_z(θ)은 다음과 같이 나타낼수 있다;

![figure1](/assets/img/posts/geometry3D2/figure11.png)
- 회전방향은 반시계 방향이다.
  
위 3개의 matrix를 조합하면 임의의 3D 회전을 표현할 수 있다.
![figure1](/assets/img/posts/geometry3D2/figure2.png)

좌표축이 아닌 임의의 단위벡터 u를 회전축으로 한 회전변환 행랼은 다음과 같다;
| 행렬곱 과정은 복잡하니 생략하겠다.
이미지 필요

2D 변환에서와 동일하게, homogenous좌표를 사용하여 선형변환 형태로 표현할 수 있다.
![figure1](/assets/img/posts/geometry3D2/figure3.png)
- 좌행렬은 다음과 같이 회전변환과 평행이동을 함께 표현한 matrix이다;
  ![figure1](/assets/img/posts/geometry3D2/figure4.png)

회전변환과 평행이동변화만으로 3D상의 움직임을 구현할 수 있다.
3D 상의 움직임의 이동전,후 두지점 사이의 변환관계를 구함으로써 정의할 수 있다

### 1-2) 회전 변환
크기가 같은 임의의 두 벡터 u = [x, y, z]T, u' = [x', y', z']T가 있을 때, u을 u'로 이동시키는 회전변환은 다음과 같이 구할 수 있다;

식1   
식2   
식3   
식4   

- θ는 두 벡터 사이의 사잇각이고, 벡터의 내적으로 구할 수 있다.
- 회전축은 두 벡터에 의해 결정되는 평면의 normal 벡터이며,단위 법선 벡터는 외적을 이용해 구할 수 있따.

회전각과 회전축을 식1에 대입하면 원하는 회전변환 행렬을 구할 수 있다.

### 1-3) 평행이동(rigid) 변환
3차원 공간에서 어떤 물체의 위치 및 방향을 결정하기 위해서 최소 몇개의 점이 필요할까?   
답은 3개이다.   
마찬가지로 3차원 공간에서 움직이는 물체의 위치관계를 표현하기 위해서는 3개의 매칭쌍만 있으면 된다. => 즉, 평행이동 변환을 결정하기 위해 필요한 점의 쌍은 3개인 것이다.

!()[]
위치A에서 (x_i,y_i,z_i), 위치A'에서 (x_i',y_i',z_i')의 형태의 point가 3개 있을 때, p1-p1', p2-p2', p3-p3'를 이용하여 (x,y,z)에서 (x',y',z')로의 평행이동 변환식을 구해야한다;
1. 3개 중 임의의 점 p1이 원점이 되도록 A를 평행이동 시킨다
2. A'의 방향과 일치되도록 회전시킨다.
3. p1'까지 평행이동시킨다.

이 과정에서 두 물체를 일치시키기 위해서 총 2번의 회전이 일어난다.   
R1) 벡터 p1p2가 벡터 p1'p2'가 되도록 회전시킨다   
R2) p3와 p3'가 일치되도록 한번 더 회전시킨다
- R1은 다음 수식을 통해 구할 수 있다;
  !()[]
- R2를 구하는 것이 핵심인데, 방법은 다음과 같다;   
  1. R1이 적용된 후, 벡터 R1*p1p2를 얻을 수 있다. 
  2. 이때 회전축은 R1*p1p2인데, 회전각은 따로 구해야한다.
  3. R1*p1p2에 수직은 평면에 p1'p3'를 projection시킨 후 사잇각이 회전각이 되게 된다.
  4. 이때 projection을 구하기 어렵기 떄문에,   
  R1*/p1p2 & R1*/p1p3 평면상의 법선벡터와 R1*p1p2 & p1'p3' 평면상의 법선벡터를 구해 두 법선벡터가 일치되도록 회전시킨다.

  => 즉, R2는 (R1*/p1p2)×(R1*/p1p3)를 (R1*p1p2)×p1'p3'로 회전시키는 행렬입니다. 


### 1-4) 월드 변환 및 좌표축 변환
object들은 월드변환(world transform)을 통해 월드좌표계로 옮겨진다.
!()[]
- 하나의 물체를 모델링하는데 사용된 좌표계 : object space
- 각 object space에서 정의된 물체들로 3차원 가상환경을 구성하려면, 하나의 좌표계로 통합해야 한다; 해당 좌표계 : world space
- 이때 행렬곱셈에서는 교환법칙이 성립하지 않는다.

월드좌표계 상에서 카메라 좌표계의 원점(카메라 초점)의 좌표가 (Fx, Fy, Fz)라고 할때,   
월드좌표계의 좌표축을 카메라 좌표계 좌표축으로 회전시키는 행렬 R 주어진다면, 월드좌표계의 임의의 점의 카메라 좌표는 다음과 같이 구할 수 있다;
!()[]

카메라 좌표계 상의 점을 월드좌표계로 바꿀떄에도, 위식을 역으로 사용하면된다.

#### (+) 좌표계 변환 방법

## 2. Imaging Geometry
3D 월드좌표에서 2D 픽셀좌표로의 변환 과정, 즉 이미지가 형성되는 과정에 대해 알아보자.
!()[]
### 2-1) 3D to 2D (원근투영변환)
투영변환이란 3차원 공간의 점을 이미지 평면에 투영시키는 변환인데, 투영변환을 모델링하는 방법에는 크게 2가지가 있다;
1. figure!처럼, 투영 기준점을 좌표계의 원점으로 잡고 이미지 평면을 전방 Zc=d에 두는 방법
   - 3차원 상의 점 p를 p'로 투영시키는 변환행렬은 다음과같다;
    !()[]
   - 투영평면이 Zc=d일 경우 (Xc,Yc,Zc,1)는 (Xc,Yc,Zc/d) = (d*/Xc/Zc,d*Yc/Zc,1)로 투영된다.
   - s: 동차좌표의 scale factor로서, 점 P의 depth에 해당한다

2. 투영시킬 이미지 평면을 좌표계 원점에 위치시키고 투영 기준점을 Zc=-d에 두는 방법
3. 만일 투영평면이 Zc=0이고, 투영 기준점을 (0,0,-d)인 경우
   - 투영변환 행렬이 다음과 같이 주어진다;

### 2-2) 월드좌표계 to 이미지 평면
월드 좌표계 상의 한점 (X,Y,Z)를 이미지 평면(픽셀 좌표계) 상의 점 (x,y)로 변환시키는 행렬을 H라 하면,   
관계식은 다음과 같다;
!()[]
H는 3x4 행렬로서, 다음과 같이 분해할 수 있다;
!()[]
!()[]

- [R|T]는 월드 좌표계를 카메라 좌표계로 바꾸는 평행이동 변환 행렬이다
- Tpers는 카메라좌표계 상의 3D좌표를 정규 이미지평면에 투영시키는 projection 행렬이다.
  - 이때,Tpers(1)는 d=1, 즉 Zc=1인 평면으로의 투영변환을 말한다.
- K는 내부 카메라 파라미터 행렬이라 하며, 정규 이미지 좌표를 픽셀 좌표로 바꿔준다.
  - 이때 rigid 변환은 카메라 외부 파라미터라 한다.


## 3. Epipolar Geometry
### 3-1) Essential Matrix
### 3-2) Fundamental Matrix
epipolar constraint
triangulation